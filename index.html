<!-- <!DOCTYPE html> -->
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM"
      crossorigin="anonymous"
    />
    <style>
      #container {
        height: 400px;
      }

      .highcharts-figure,
      .highcharts-data-table table {
        min-width: 310px;
        max-width: 800px;
        margin: 1em auto;
      }

      .highcharts-data-table table {
        font-family: Verdana, sans-serif;
        border-collapse: collapse;
        border: 1px solid #ebebeb;
        margin: 10px auto;
        text-align: center;
        width: 100%;
        max-width: 500px;
      }

      .highcharts-data-table caption {
        padding: 1em 0;
        font-size: 1.2em;
        color: #0a0909;
      }

      .highcharts-data-table th {
        font-weight: 600;
        padding: 0.5em;
      }

      .highcharts-data-table td,
      .highcharts-data-table th,
      .highcharts-data-table caption {
        padding: 0.5em;
      }

      .highcharts-data-table thead tr,
      .highcharts-data-table tr:nth-child(even) {
        background: #faf0f0;
      }

      .highcharts-data-table tr:hover {
        background: #eeeaea;
      }
    </style>
  </head>
  <!----filter: blur(8px);
    -webkit-filter: blur(8px); -->
  <body
    style="
      background-image: url(rainy.jpg);
      background-position: 0%;
      background-size: contain;
    "
  >
    <div class="background">
      <div class="mb-4 p-3 bg-primary text white" id="i">
        <nav
          class="navbar navbar-expand-sm bg-b navbar-light"
          style="background-image: url(sanfra2.jpg); background-size: cover"
        >
          <div class="container-fluid">
            <a class="navbar-brand" href="#">
              <button type="button" id="update" class="btn btn-primary">
                UPDATE WEATHER
              </button>
              <div id="weatherContainer"></div>
            </a>

            <h5 class="weather" style="color: rgb(43, 39, 39)">
              WE<span style="color: rgb(33, 33, 250); margin-right: 100px"
                >ATHER</span
              >
            </h5>
            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="nav-link active" href="#" id="weathertoday"
                  >weather today</a
                >
                <ul id="weatherList"></ul>
              </li>
              <li class="nav-item" id="a">
                <a class="nav-link" href="#" id="hotplace">HOT places</a>
                <div id="hotCity"></div>
              </li>
              <li class="nav-item" id="a">
                <a class="nav-link" href="#" id="coldplace">Cold places</a>
                <div id="coldCity"></div>
              </li>
              <li class="nav-item" id="a">
                <a class="nav-link" href="#" id="a"></a>
              </li>
            </ul>
          </div>
          <form class="d-flex" role="search">
            <input type="text" id="searchInput" placeholder="Enter city name" />
            <button type="button" class="btn btn-primary" id="search">
              search
            </button>
            <div id="weatherContainer"></div>
          </form>
        </nav>
      </div>

      <div class="container m-3">
        <div
          class="row"
          id="container"
          style="margin-left: 100px; width: 1300px"
        ></div>
      </div>
      <script src="https://code.highcharts.com/highcharts.js"></script>
      <script src="https://code.highcharts.com/highcharts-more.js"></script>
      <script src="https://code.highcharts.com/modules/exporting.js"></script>
      <script src="https://code.highcharts.com/modules/export-data.js"></script>
      <script src="https://code.highcharts.com/modules/accessibility.js"></script>
      <figure class="highcharts-figure">
        <div id="container"></div>
        <p class="highcharts-description">
          Chart demonstrating using an arearange series in combination with a
          line series. In this case, the arearange series is used to visualize
          the temperature range per day, while the line series shows the average
          temperature.
        </p>
      </figure>
      <script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
        crossorigin="anonymous"
      ></script>

      <script>
        function drawChart(averages, ranges) {
          document.getElementById("container").innerHTML = "";
          Highcharts.chart("container", {
            title: {
              text: "Temperature with in the next 5 days",
              align: "left",
            },

            subtitle: {
              text:
                "Source: " +
                '<a href="https://www.yr.no/nb/historikk/graf/1-113585/Norge/Viken/Nesbyen/Nesbyen?q=2022-07"' +
                'target="_blank">YR</a>',
              align: "left",
            },

            xAxis: {
              type: "datetime",
              accessibility: {
                rangeDescription: "", //"Range: Jul 1st 2022 to Jul 31st 2022.",
              },
            },

            yAxis: {
              title: {
                text: "y axis",
              },
            },

            tooltip: {
              crosshairs: true,
              shared: true,
              valueSuffix: "°C",
            },

            plotOptions: {
              series: {
                pointStart: Date.UTC(2022, 6, 1),
                pointIntervalUnit: "day",
              },
            },

            series: [
              {
                name: "Temperature",
                data: averages,
                zIndex: 1,
                marker: {
                  fillColor: "white",
                  lineWidth: 2,
                  lineColor: Highcharts.getOptions().colors[0],
                },
              },
              {
                name: "Range",
                data: ranges,
                type: "arearange",
                lineWidth: 0,
                linkedTo: ":previous",
                color: Highcharts.getOptions().colors[0],
                fillOpacity: 0.3,
                zIndex: 0,
                marker: {
                  enabled: false,
                },
              },
            ],
          });
        }
      </script>
      <script>
        const apiKey = "fff721680d7794452f175d3d56d49b89";
        const cities = [
          { name: "Addis Ababa", latitude: 9.145, longitude: 38.74 },
          { name: "Dire Dawa", latitude: 9.6, longitude: 41.85 },
          { name: "Mekelle", latitude: 13.496, longitude: 39.475 },
          {name: "Arba Minch", latitude:6.0206, longitude: 37.56},
          {name: "Hawassa", latitude:7.0504, longitude: 38.495},
          {name: "Bahir Dar", latitude:11.574, longitude: 37.361},
          {name: "Debre Birhan", latitude:9.6767, longitude: 39.533},
          
        ];

        async function fetchCityWeather({ latitude, longitude }, apiKey) {
          const apiUrl = `https://api.openweathermap.org/data/2.5/forecast?lat=${latitude}&lon=${longitude}&appid=${apiKey}&units=metric`;
          const response = await fetch(apiUrl);
          const data = await response.json();
          const dateTemps = {};

          data.list.forEach((datum) => {
            const date = datum.dt_txt.split(" ")[0];
            if (dateTemps[date] === undefined) dateTemps[date] = [];
            dateTemps[date].push(datum.main.temp);
          });

          let averages = [];
          let ranges = [];

          for (const i in dateTemps) {
            var minimumTemp = Math.min.apply(Math, dateTemps[i]);
            var maximumTemp = Math.max.apply(Math, dateTemps[i]);

            const avg = (minimumTemp + maximumTemp) / 2;

            averages.push(avg);
            ranges.push([minimumTemp, maximumTemp]);
          }
          drawChart(averages, ranges);
          const temperature = data.list[0].main.temp;
          const weatherDescription = data.list[0].weather[0].description;

          return { temperature, weatherDescription };
        }
        // Add event listener to the button
        const moviesLink = document.getElementById("weathertoday");
        moviesLink.addEventListener("click", async () => {
          for (const city of cities) {
            const { temperature, weatherDescription } = await fetchCityWeather(
              city,
              apiKey
            );
            const listItem = document.createElement("li");
            listItem.textContent = ` ${name}: Temperature: ${temperature}°C, Weather: ${weatherDescription}`;

            // Add the list item to the weather list
            weatherList.appendChild(listItem);
          }
        });

        // Add event listener to the button
        const updateButton = document.getElementById("update");
        updateButton.addEventListener("click", async () => {
          const randomCity = cities[Math.floor(Math.random() * cities.length)];
          const { temperature, weatherDescription } = await fetchCityWeather(
            randomCity,
            apiKey
          );
          const weatherContainer = document.getElementById("weatherContainer");
          weatherContainer.innerHTML = `City: ${randomCity.name}<br>Temperature: ${temperature}°C<br>Weather: ${weatherDescription}`;
        });

        async function setExtremeCity({ isHottest, htmlElement }) {
          htmlElement.innerHTML = "";

          const promises = cities.map((city) => fetchCityWeather(city, apiKey));
          const results = await Promise.all(promises);
          console.log(results);

          if (!results.length) {
            hotCity.textContent = "No hot city found";
            return;
          }

          let maxName = cities[0].name;
          let maxTemp = results[0].temperature;
          for (let i = 0; i < results.length; i++) {
            if (isHottest === results[i].temperature > maxTemp) {
              maxName = cities[i].name;
              maxTemp = results[i].temperature;
            }
          }

          if (isHottest) {
            htmlElement.textContent = `Hottest City: ${maxName}`;
            console.log(maxName);
            fetchCityWeatherByName(maxName, apiKey);
          } else {
            htmlElement.textContent = `Coldest City: ${maxName}`;
            console.log(maxName);
            fetchCityWeatherByName(maxName, apiKey);
          }
        }

        // Add event listener to the link
        const hotPlacesLink = document.getElementById("hotplace");
        hotPlacesLink.addEventListener("click", async () => {
          await setExtremeCity({
            isHottest: true,
            htmlElement: document.getElementById("hotCity"),
          });
        });

        const coldPlacesLink = document.getElementById("coldplace");
        coldPlacesLink.addEventListener("click", async () => {
          await setExtremeCity({
            isHottest: false,
            htmlElement: document.getElementById("coldCity"),
          });
        });

        // Function to make the API request and update the weather data on the page
        async function fetchCityWeatherByName(cityName, apiKey) {
          const apiUrl = `https://api.openweathermap.org/data/2.5/forecast?q=${cityName}&appid=${apiKey}&units=metric`;
          const response = await fetch(apiUrl);
          const data = await response.json();
          const dateTemps = {};

          data.list.forEach((datum) => {
            const date = datum.dt_txt.split(" ")[0];
            if (dateTemps[date] === undefined) dateTemps[date] = [];
            dateTemps[date].push(datum.main.temp);
          });

          let averages = [];
          let ranges = [];

          for (const i in dateTemps) {
            var minimumTemp = Math.min.apply(Math, dateTemps[i]);
            var maximumTemp = Math.max.apply(Math, dateTemps[i]);

            const avg = (minimumTemp + maximumTemp) / 2;

            averages.push(avg);
            ranges.push([minimumTemp, maximumTemp]);
          }
          drawChart(averages, ranges);
          const temperature = data.list[0].main.temp;
          const weatherDescription = data.list[0].weather[0].description;

          return { temperature, weatherDescription };
        }

        // Add event listener to the button
        const searchButton = document.getElementById("search");
        searchButton.addEventListener("click", async () => {
          const searchInput = document.getElementById("searchInput");
          const cityName = searchInput.value;
          const weatherContainer = document.getElementById("weatherContainer");

          try {
            const { temperature, weatherDescription } =
              await fetchCityWeatherByName(cityName, apiKey);
            weatherContainer.innerHTML = `Temperature: ${temperature}°C<br>Weather: ${weatherDescription}`;
          } catch (error) {
            console.error("Error fetching weather data:", error);
            weatherContainer.innerHTML = "Error fetching weather data";
          }
        });
        fetchCityWeatherByName("Addis Ababa", apiKey);
      </script>
    </div>
  </body>
</html>
